# ISO 27001 Security Reference

Security controls and requirements based on ISO/IEC 27001:2022 Information Security Management System (ISMS).

---

## A.5 Organizational Controls

### A.5.1 Policies for Information Security

**Check for:**
- Security policies documented and accessible
- Policy review dates and version control
- Policy acknowledgment by employees

**In code, verify:**
```
# Check for policy references in documentation
Grep: security policy, acceptable use, information security
```

### A.5.15 Access Control

**Check for:**
- Principle of least privilege
- Role-based access control (RBAC)
- Access review processes

**In code, verify:**
```python
# Vulnerable - No role check
@app.get("/admin/users")
async def get_users():
    return await db.query(User).all()

# Compliant - Role-based access
@app.get("/admin/users")
async def get_users(user: User = Depends(require_admin)):
    return await db.query(User).all()
```

### A.5.17 Authentication Information

**Check for:**
- Strong password policies (min 12 chars, complexity)
- MFA implementation
- Secure password storage (bcrypt, argon2)
- No password hints

**In code, verify:**
```python
# Non-compliant - Weak hashing
password_hash = hashlib.md5(password.encode()).hexdigest()

# Compliant - Strong hashing
from passlib.hash import bcrypt
password_hash = bcrypt.hash(password)
```

---

## A.6 People Controls

### A.6.3 Information Security Awareness

**Check for:**
- Security training records
- Phishing awareness
- Secure coding training for developers

### A.6.5 Responsibilities After Termination

**Check for:**
- Account deactivation procedures
- Access revocation on termination
- Return of assets procedures

---

## A.7 Physical Controls

### A.7.4 Physical Security Monitoring

**Check for:**
- Logging of physical access (if applicable)
- Data center security documentation

---

## A.8 Technological Controls

### A.8.2 Privileged Access Rights

**Check for:**
- Admin accounts are limited
- Privileged actions are logged
- Separate admin accounts from regular accounts

**In code, verify:**
```python
# Check for privileged operation logging
async def delete_user(user_id: int, admin: User = Depends(require_admin)):
    logger.info(f"Admin {admin.id} deleted user {user_id}")  # Required
    await db.delete(User, user_id)
```

### A.8.3 Information Access Restriction

**Check for:**
- Data classification implementation
- Access controls match data sensitivity
- Sensitive data encryption

**In code, verify:**
```python
# Check RLS policies exist for sensitive tables
# Check encryption for PII fields
```

### A.8.4 Access to Source Code

**Check for:**
- Source code access is restricted
- No secrets in source code
- Code review requirements

### A.8.5 Secure Authentication

**Check for:**
- Multi-factor authentication for privileged access
- Session timeout implementation
- Account lockout after failed attempts

**In code, verify:**
```python
# Session timeout
SESSION_TIMEOUT = 30 * 60  # 30 minutes

# Account lockout
MAX_LOGIN_ATTEMPTS = 5
LOCKOUT_DURATION = 15 * 60  # 15 minutes
```

### A.8.9 Configuration Management

**Check for:**
- Secure default configurations
- Configuration change logging
- No debug mode in production

**In code, verify:**
```python
# Non-compliant
app = FastAPI(debug=True)

# Compliant
DEBUG = os.getenv("ENVIRONMENT") == "development"
app = FastAPI(debug=DEBUG)
```

### A.8.10 Information Deletion

**Check for:**
- Data retention policies
- Secure deletion procedures
- User data deletion on request (also GDPR)

**In code, verify:**
```python
# Implement soft delete with hard delete after retention period
class User:
    deleted_at: Optional[datetime]  # Soft delete

# Background job for hard delete after retention
async def purge_deleted_users():
    cutoff = datetime.now() - timedelta(days=RETENTION_DAYS)
    await db.execute("DELETE FROM users WHERE deleted_at < :cutoff", {"cutoff": cutoff})
```

### A.8.12 Data Leakage Prevention

**Check for:**
- No sensitive data in logs
- No PII in URLs
- Response filtering

**In code, verify:**
```python
# Non-compliant - PII in logs
logger.info(f"User login: {user.email}, SSN: {user.ssn}")

# Compliant - Masked logging
logger.info(f"User login: {mask_email(user.email)}")
```

### A.8.15 Logging

**Check for:**
- Security events are logged
- Logs include who, what, when, where
- Log integrity protection
- Log retention meets requirements

**Required log events:**
- Authentication attempts (success/failure)
- Authorization failures
- Data access to sensitive resources
- Admin actions
- Security configuration changes

**In code, verify:**
```python
# Structured security logging
import structlog

logger = structlog.get_logger()

async def login(credentials: LoginRequest):
    user = await authenticate(credentials)
    if user:
        logger.info("authentication_success",
            user_id=user.id,
            ip=request.client.host,
            user_agent=request.headers.get("user-agent"))
    else:
        logger.warning("authentication_failure",
            email=credentials.email,
            ip=request.client.host,
            reason="invalid_credentials")
```

### A.8.16 Monitoring Activities

**Check for:**
- Security monitoring in place
- Alerting for security events
- Anomaly detection

### A.8.20 Network Security

**Check for:**
- Network segmentation
- Firewall rules documented
- VPN for remote access

### A.8.21 Security of Network Services

**Check for:**
- TLS/HTTPS enforcement
- Certificate management
- Secure protocols only

**In code, verify:**
```python
# Check for HSTS header
response.headers["Strict-Transport-Security"] = "max-age=31536000; includeSubDomains"

# Check TLS version requirements
# Minimum TLS 1.2
```

### A.8.24 Use of Cryptography

**Check for:**
- Strong encryption algorithms (AES-256, RSA-2048+)
- Secure key management
- No deprecated algorithms (MD5, SHA1, DES)

**In code, verify:**
```python
# Non-compliant
hashlib.md5(data)
hashlib.sha1(data)
DES.new(key)

# Compliant
hashlib.sha256(data)
AES.new(key, AES.MODE_GCM)
```

### A.8.25 Secure Development Lifecycle

**Check for:**
- Security requirements in design
- Secure coding standards
- Security testing (SAST, DAST)
- Dependency scanning

### A.8.26 Application Security Requirements

**Check for:**
- Input validation
- Output encoding
- Error handling
- Session management

### A.8.27 Secure System Architecture

**Check for:**
- Defense in depth
- Separation of concerns
- Secure defaults

### A.8.28 Secure Coding

**Check for:**
- No injection vulnerabilities
- Parameterized queries
- Input validation
- Output encoding

**In code, verify:**
```python
# Non-compliant - SQL injection
query = f"SELECT * FROM users WHERE id = {user_id}"

# Compliant - Parameterized
query = "SELECT * FROM users WHERE id = :id"
await db.execute(query, {"id": user_id})
```

### A.8.31 Separation of Development, Test and Production

**Check for:**
- Separate environments
- No production data in dev/test
- Environment-specific configurations

**In code, verify:**
```python
# Check environment separation
ENVIRONMENT = os.getenv("ENVIRONMENT", "development")

# Different configs per environment
if ENVIRONMENT == "production":
    DATABASE_URL = os.getenv("PROD_DATABASE_URL")
else:
    DATABASE_URL = os.getenv("DEV_DATABASE_URL")
```

### A.8.32 Change Management

**Check for:**
- Change approval process
- Change logging
- Rollback procedures

### A.8.33 Test Information

**Check for:**
- No production data in tests
- Test data is anonymized
- Sensitive test data is protected

### A.8.34 Protection of Information Systems During Audit Testing

**Check for:**
- Audit activities are controlled
- Audit tools access is restricted

---

## ISO 27001 Checklist for Code Review

### Authentication & Access Control
- [ ] Role-based access control implemented
- [ ] Principle of least privilege enforced
- [ ] MFA available for privileged accounts
- [ ] Session management is secure
- [ ] Account lockout implemented

### Cryptography
- [ ] Strong encryption algorithms used
- [ ] No deprecated algorithms (MD5, SHA1, DES)
- [ ] Keys not hardcoded
- [ ] TLS 1.2+ enforced

### Logging & Monitoring
- [ ] Security events are logged
- [ ] Logs include who, what, when, where
- [ ] No sensitive data in logs
- [ ] Log retention configured

### Secure Development
- [ ] Input validation on all inputs
- [ ] Parameterized queries used
- [ ] Output encoding implemented
- [ ] Error messages don't leak information

### Configuration Management
- [ ] No debug mode in production
- [ ] Secrets in environment variables
- [ ] Security headers configured
- [ ] HTTPS enforced

### Data Protection
- [ ] PII is encrypted
- [ ] Data retention policies implemented
- [ ] Secure deletion available
- [ ] No sensitive data in URLs

---

## Files to Check for ISO 27001 Compliance

| File/Pattern | What to Check |
|--------------|---------------|
| `*.py`, `*.ts` | Access control, input validation, crypto |
| `*config*`, `*settings*` | Secure defaults, no secrets |
| `*auth*`, `*login*` | Authentication controls, MFA |
| `*log*` | Logging implementation, no PII |
| `.env*` | Not committed, proper separation |
| `migrations/*.sql` | RLS, encryption |
| `middleware/*` | Security headers, auth checks |
